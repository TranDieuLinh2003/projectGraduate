<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.springframework.org/schema/data/jaxb">

<head>
    <title>Thông tin tài khoản</title>
    <link rel="stylesheet" th:href="@{/users/css/web.css}">
    <link rel="stylesheet" th:href="@{/users/css/thongtincanhan.css}">
    <link rel="icon" th:href="@{/users/img//logo.png}" type="image/x-icon"/>
</head>
<body>
<div th:replace="~{/layout/Header :: header}"></div>
<li th:if="${customer != null}">
    <br>
    <!---->
    <div class="header_tab">
        <div class="tabs">
            <input type="radio" name="tabs" id="tabone" checked="checked">
            <label for="tabone">Thông tin tài khoản</label>
            <div class="tab">
                <div class="infor">
                    <table>
                        <thead>
                        <tr>
                            <th>Hạng thành viên</th>
                            <th>Tổng chi tiêu</th>
                            <th>Điểm tích lũy</th>
                            <th>Điểm đã tiêu</th>
                            <th>Điểm khả dụng</th>

                        </tr>
                        </thead>
                        <tbody>
                        <th:block th:each="custom : ${listCustomer}">
                            <tr class="clickable">
                                <td>
                                    [[${custom[2]}]]
                                </td>
                                <td id="pricee">
                                    [[${custom[1]}]]
                                </td>
                                <td id="point">
                                    [[${custom[0]}]]
                                </td>
                                <td>
                                    [[${custom[4]}]]
                                </td>
                                <td>
                                    [[${custom[3]}]]
                                </td>
                            </tr>
                        </th:block>
                        <!-- Add more rows as needed -->
                        </tbody>
                    </table>
                </div>
                <form th:action="@{/filmbooking/update-thongtin/${customer.id}}" method="post">
                    <div class="container" id="app">

                        <div>
                            <fieldset>
                                <legend>* Họ Tên</legend>
                                <input type="text" th:value="${customer.name}" name="name" @focus="show"
                                       data-layout="normal"/>
                            </fieldset>

                            <fieldset>
                                <legend>* Email</legend>
                                <input type="text" th:value="${customer.email}" name="email" @focus="show"
                                       data-layout="compact"/>
                            </fieldset>
                        </div>

                        <div>
                            <fieldset>
                                <legend>* Phone_Number</legend>
                                <input type="text" th:value="${customer.phoneNumber}" name="phoneNumber" @focus="show"
                                       data-layout="numeric"/>

                            </fieldset>

                            <fieldset>
                                <legend>* Password</legend>
                                <input type="password" th:value="${customer.password}" class="password" @focus="show"
                                       data-layout="numeric"/>
                                <button class="unmask" type="button"
                                        title="Mask/Unmask password to check content">Unmask
                                </button>
                            </fieldset>
                        </div>
                        <button id="cancel" class="button cancel-button">Cập nhập</button>

                    </div>
                </form>
            </div>
            <input type="radio" name="tabs" id="tabtwo">
            <label for="tabtwo">Hóa đơn chờ xác nhận <span style="color: red;font-size: 15px;width: 25px; height: 25px"
                                                           class="badge1 text-bg-secondary">[[${soldTicketsCountBill}]]</span></label>
            <div class="tab" id="hanhchinhdienanh1">
                <table>
                    <thead>
                    <tr>
                        <th>Mã giao dịch</th>
                        <th>Phim</th>
                        <th>Rạp/phòng chiếu</th>
                        <th>Suất chiếu</th>
                        <th>Ghế đã đặt</th>
                        <th>Đồ ăn</th>
                        <th>Ngày đặt</th>
                        <th>Trạng thái</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="entry : ${groupedBillDetailsCho}">
                        <!--                    <td th:text="${entry}">Transaction ID</td>-->
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[0]}">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[1]}">Detail 1</span><br>
                                    <img width="50px" height="70px"
                                         th:src="${'http://localhost:8080/admin/assets/img/'+ detail[2]}">
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[3]}">Detail 1</span>,
                                    <span th:text="${detail[10]}">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${#dates.format(detail[4], 'dd/MM/yyyy HH:mm')}">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[5]}">Detail 1</span>
                                    (<span th:text="${detail[6]}">Detail 1</span>)
                                    <hr>
                                    <b>Tổng tiền:</b>
                                    <span id="priceCho1" th:text="${detail[6]*detail[9]}">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[7]}">Detail 1</span>
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${#dates.format(detail[8], 'dd/MM/yyyy HH:mm')}">Detail 1</span>
                                    <hr>
                                    + <span id="poinn" th:text="${detail[13]}">Detail 1</span> điểm tích lũy
                                    <hr>
                                    <span th:if="${detail[14] == null}">-0 điểm tiêu dùng</span>
                                    <span th:if="${detail[14] != null}"
                                          th:text="${-detail[14]} + ' điểm tiêu dùng'"></span>
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[11]== 0 } ?'Chờ thanh toán':'Chờ thanh toán'">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                    </tr>

                    </tbody>
                </table>
            </div>
            <input type="radio" name="tabs" id="tabthree">
            <label for="tabthree">Hành trình điện ảnh</label>
            <div class="tab" id="hanhchinhdienanh">
                <table>
                    <thead>
                    <tr>
                        <th>Mã giao dịch</th>
                        <th>Phim</th>
                        <th>Rạp/Phòng chiếu</th>
                        <th>Suất chiếu</th>
                        <th>Ghế đã đặt</th>
                        <th>Đồ ăn</th>
                        <th>Ngày đặt</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="entry : ${groupedBillDetails}">
                        <!--                    <td th:text="${entry}">Transaction ID</td>-->
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[0]}">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td id="namefilm">
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[1]}">Detail 1</span><br>
                                    <img width="50px" height="70px"
                                         th:src="${'http://localhost:8080/admin/assets/img/' +detail[2]}">
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[3]}">Detail 1</span>,
                                    <span th:text="${detail[10]}">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${#dates.format(detail[4], 'dd/MM/yyyy HH:mm')}">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[5]}">Detail 1</span>
                                    (<span th:text="${detail[6]}">Detail 1</span>)
                                    <hr>
                                    <b>Tổng tiền:</b>
                                    <span id="price" th:text="${detail[6]*detail[9]}">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span id="priceFood" th:text="${detail[7]}">Detail 1</span>

                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${#dates.format(detail[8], 'dd/MM/yyyy HH:mm')}">Detail 1</span>
                                    <hr>
                                    + <span id="poin" th:text="${detail[13]}">Detail 1</span> điểm tích lũy
                                    <hr>
                                    <span th:if="${detail[14] == null}">-0 điểm tiêu dùng</span>
                                    <span th:if="${detail[14] != null}"
                                          th:text=" -${detail[14]} + ' điểm tiêu dùng'"></span>
                                </li>
                            </ul>
                        </td>

                    </tr>

                    </tbody>
                </table>
            </div>
            <input type="radio" name="tabs" id="tabfor">
            <label for="tabfor">Hóa đơn đã hủy</label>
            <div class="tab" id="hanhchinhdienanh3">
                <table>
                    <thead>
                    <tr>
                        <th>Mã giao dịch</th>
                        <th>Phim</th>
                        <th>Rạp/phòng chiếu</th>
                        <th>Suất chiếu</th>
                        <th>Ghế đã đặt</th>
                        <th>Đồ ăn</th>
                        <th>Ngày đặt</th>
                        <th>Trạng thái</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="entry : ${groupedBillDetailsHuy}">
                        <!--                    <td th:text="${entry}">Transaction ID</td>-->
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[0]}">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[1]}">Detail 1</span><br>
                                    <img width="50px" height="70px"
                                         th:src="${'http://localhost:8080/admin/assets/img/' +detail[2]}">
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[3]}">Detail 1</span>,
                                    <span th:text="${detail[10]}">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${#dates.format(detail[4], 'dd/MM/yyyy HH:mm')}">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[5]}">Detail 1</span>
                                    (<span th:text="${detail[6]}">Detail 1</span>)
                                    <hr>
                                    <b>Tổng tiền:</b>
                                    <span id="priceHuy" th:text="${detail[6]*detail[9]}">Detail 1</span>
                                    <!-- Add more spans for other details -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${detail[7]}">Detail 1</span>
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    <span th:text="${#dates.format(detail[8], 'dd/MM/yyyy HH:mm')}">Detail 1</span>
                                    <hr>
                                    + <span id="poinnn" th:text="${detail[13]}">Detail 1</span> điểm tích lũy
                                    <hr>
                                    <span th:if="${detail[15] == null}">-0 điểm tiêu dùng</span>
                                    <span th:if="${detail[15] != null}"
                                          th:text="${-detail[15]} + ' điểm tiêu dùng'"></span>
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li style="list-style: none;" th:each="detail : ${entry.value}">
                                    <!-- Display other details as per your requirement -->
                                    ( <span
                                        th:text="${detail[11]==0 ? 'Chờ thanh toán' : (detail[11]==1 ? 'Đã thanh toán' : 'Đã hủy')}"></span>)
                                    <span th:text="${'Thời gian hủy:'+#dates.format(detail[14], 'dd/MM/yyyy HH:mm')}">Detail 1</span>
                                </li>
                            </ul>
                        </td>
                    </tr>

                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <br>
</li>
<li th:unless="${customer != null}">
    <script th:inline="javascript">
        /*<![CDATA[*/
        window.location.href = '/filmbooking/login';
        /*]]>*/
    </script>
</li>

<div th:replace="~{/layout/Footer :: footer}"></div>
</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $('.unmask').on('click', function () {
        var inputField = $(this).prev('input');
        var currentType = inputField.attr('type');

        if (currentType === 'password') {
            inputField.attr('type', 'text');
        } else {
            inputField.attr('type', 'password');
        }

        return false;
    });

    var priceElements = document.querySelectorAll("#price,#price1,#priceCho,#priceCho1, #priceSum,#priceHuy, #pricee");

    // Loop through each element and format its content to VND
    priceElements.forEach(function (element) {
        var price = parseFloat(element.innerHTML);
        var formattedPrice = new Intl.NumberFormat('vi-VN', {style: 'currency', currency: 'VND'}).format(price);
        // Set the formatted price as the inner HTML of the element
        element.innerHTML = formattedPrice;
    });

    // Lấy tất cả các phần tử có id là "poin"
    var elements = document.querySelectorAll("#poin, #poinn, #poinnn");

    // Duyệt qua từng phần tử và thực hiện việc bỏ hết số 0 sau dấu chấm rồi chuyền giá trị ngược lại
    elements.forEach(function (element) {
        var originalNumber = element.innerHTML;
        var number = parseFloat(originalNumber);
        var roundedNumber = number.toFixed(0);
        element.innerHTML = roundedNumber;
    });

</script>
</html>